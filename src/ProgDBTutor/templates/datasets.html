<html>
<head>

    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

	<link rel="stylesheet" href="{{ url_for('static',filename='bootstrap-4.0.0.min.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='style/style.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='style/home_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='style/datasets_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='style/sharedStyle.css') }}">

	<script src="{{ url_for('static',filename='jquery-3.2.1.js') }}"></script>
	<script src="{{ url_for('static',filename='bootstrap-4.0.0.min.js') }}"></script>
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
</head>
<body>


<nav class="navbar" id="navbar">
    <div class="navbar_container">
        <div class="navbar_toggle" id="mobile-menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
        <ul class="navbar_menu">
            <li class="navbar_items"><a class="navbar_links" id="home-page" href="home">Home</a></li>
            <li class="navbar_items"><a class="navbar_links" id="services-page" href="services">A/B-test</a></li>
            <li class="navbar_items"><a class="navbar_links" id="datasets-page" href="datasets">Datasets</a></li>
            <li class="navbar_items"><a class="navbar_links" id="visualizations-page" href="visualizations">Visualizations</a></li>
            <li class="navbar_items"><a class="navbar_links" id="testlist-page" href="testlist">Testlist</a></li>
        </ul>
    </div>
</nav>

<div class="giantcontainer">

    <form method="GET" action="" name="form1">
    <div class="_container0" id="_container0" style="display: block;">
        <div class="_row">
            <div class="_column">
                <select class="c0_select" id="datasetSelection" name="datasetSelection" onchange="sendData()">
                    {% for id, name in names %}
                        <option value="{{ id }}">dataset: {{ name }}</option>
                    {% endfor %}
                </select>
            </div>

            <div class="_column">
                <button class="c0_button" role="button" id="add_btn" name="add_btn" onclick="toggleDatasetView();">
                    Add dataset
                </button>
            </div>

        </div>
    </div>

    <div class="_container1" id="_container1" style="display: block;">
        <div class="_row">
            <div class="_column">
                <div class="c1_statcontainer">
                    <h2>Number of customers:</h2>
                    <p id="nr_of_customers">0</p>
                </div>
            </div>
            <div class="_column">
                <div class="c1_statcontainer">
                    <h2>Number of items:</h2>
                    <p id="nr_of_items">0</p>
                </div>
            </div>
            <div class="_column">
                <div class="c1_statcontainer">
                    <h2>Number of interactions:</h2>
                    <p id="nr_of_interactions">0</p>
                </div>
            </div>
        </div>
        <div class="_row">
            <div class="_column">
                <div class="c1_graphcontainer" id="graph-active">

                </div>
            </div>
            <div class="_column">
                <div class="c1_graphcontainer" id="graph-distr">

                </div>
            </div>
        </div>

    </div>

    <div class="_container2" id="_container2" style="display: block;">
        <div class="_row">
            <div class="_column">
                <button class="c2_button_" role="button" id="add_btn" name="add_btn" onclick="">
                    Go to A/B-test page with this dataset
                </button>
            </div>
            <div class="_column">
                <button class="c2_button_" type="submit" role="button" id="delete_btn" name="delete_btn">
                    Delete dataset
                </button>
            </div>
        </div>
    </div>
    </form>
    <div class="_container3" id="_container3" style="display: none;">
        <form method="POST" action="" enctype="multipart/form-data" name="form2">
            <div class="_row">
                <div class="_column">
                    <div class="c3_namecontainer">
                        <input type="text" id="ds_name" name="ds_name" placeholder="Enter dataset name" required>
                    </div>
                </div>
            </div>

            <div class="_row">

                <div class="_column">
                    <div class="c3_filecontainer">
                        <h2> Articles file</h2>
                        <div id="btn1" onclick="getFile1()"> Choose file </div>
                        <div style="height: 0px; width: 0px; overflow: hidden;">
                            <input type="file" id="articles_file" name="articles_file" value="upload1" accept=".csv" required onchange="sub1(this)">
                        </div>
{#                        <form method="POST" action="" id="typeform1">#}
                        <div class="typeformcontainer" id="typeformcontainer">

                            {% for attr in attributes['articles'] %}
                                <div class="row">
                                    <div class="col-25" style="width: 60%; text-align: left;"><label for="{{ attr }}">{{ attr }}</label></div>
                                    <div class="col-75" style="width: 40%">
                                        <select class="" id="" name="">
                                            {% for atype in attr_types %}
                                                <option value="{{ atype }}">{{ atype }}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                            {% endfor %}

                        </div>
{#                        </form>#}
                        <div class="choosenamecontainer">
                            <select class="" id="" name="">
                                {% for attr in attributes['articles'] %}
                                    <option value="{{ attr }}">{{ attr }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>

                <div class="_column">
                    <div class="c3_filecontainer">
                        <h2> Purchases file</h2>
                        <div id="btn2" onclick="getFile2()"> Choose file </div>
                        <div style="height: 0px; width: 0px; overflow: hidden;">
                            <input type="file" id="purchases_file" name="purchases_file" value="upload2" accept=".csv" required onchange="sub2(this)">
                        </div>
                    </div>
                </div>

                <div class="_column">
                    <div class="c3_filecontainer">
                        <h2> Customers file</h2>
                        <div id="btn3" onclick="getFile3()"> Choose file </div>
                        <div style="height: 0px; width: 0px; overflow: hidden;">
                            <input type="file" id="customers_file" name="customers_file" value="upload3" accept=".csv" required onchange="sub3(this)">
                        </div>
                        <div class="typeformcontainer" id="typeformcontainer">
{#                            <form method="POST" action="" id="typeform2">#}
                                {% for attr in attributes['customers'] %}
                                    <div class="row">
                                        <div class="col-25" style="width: 60%; text-align: left;"><label for="{{ attr }}">{{ attr }}</label></div>
                                        <div class="col-75" style="width: 40%">
                                            <select class="" id="" name="">
                                                {% for atype in attr_types %}
                                                    <option value="{{ atype }}">{{ atype }}</option>
                                                {% endfor %}
                                            </select>
                                        </div>
                                    </div>
                                {% endfor %}
{#                            </form>#}
                        </div>
                        <div class="choosenamecontainer">
                            <select class="" id="" name="">
                                {% for attr in attributes['customers'] %}
                                    <option value="{{ attr }}">{{ attr }}</option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>
                </div>
            </div>

{#            <div class="_row">#}
{#                <div class="_column">#}
{#                    <div class="c3_typespeccontainer">#}
{##}
{#                    </div>#}
{#                </div>#}
{#                <div class="_column">#}
{#                    <div class="c3_typespeccontainer">#}
{##}
{#                    </div>#}
{#                </div>#}
{#                <div class="_column">#}
{#                    <div class="c3_typespeccontainer">#}
{##}
{#                    </div>#}
{#                </div>#}
{#            </div>#}

            <div class="_row">
                <div class="_column">
                    <div class="c3_button">
                        <button type="submit" role="button">
                            Add dataset
                        </button>
                    </div>
                </div>
                <div class="_column">
                    <div class="c3_button">
                        <button type="submit" role="button" onclick="toggleDatasetView()">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>

</div>


<script>
    {#var row_id = 0;#}
window.onload = sendData();

if(document.getElementById("articles_file").value != "") {

}

if(document.getElementById("articles_file").value != "") {

}

{#$('#scrolltable tbody tr').click(function() {#}
{#    $(this).addClass('highlight').siblings().removeClass('highlight');#}
{#);#}

function getFile1() {
    document.getElementById("articles_file").click();
}
function getFile2() {
    document.getElementById("purchases_file").click();
}
function getFile3() {
    document.getElementById("customers_file").click();
}

function sub1(obj) {
    var file = obj.value;
    var filename = file.split("\\");
    document.getElementById("btn1").innerHTML = filename[filename.length - 1];
    event.preventDefault();
}

function sub2(obj) {
    var file = obj.value;
    var filename = file.split("\\");
    document.getElementById("btn2").innerHTML = filename[filename.length - 1];
    event.preventDefault();
}

function sub3(obj) {
    var file = obj.value;
    var filename = file.split("\\");
    document.getElementById("btn3").innerHTML = filename[filename.length - 1];
    event.preventDefault();
}

function sendData() {
    let id = document.getElementById("datasetSelection").value;

    fetch(`/datasets/${id}`).then(function(response) {
        return response.text();
    }).then(function(text) {
        console.log(text)
        var statistics = JSON.parse(text)
        console.log()
        document.getElementById("nr_of_customers").innerHTML = statistics[0].users
        document.getElementById("nr_of_items").innerHTML = statistics[0].articles
        document.getElementById("nr_of_interactions").innerHTML = statistics[0].interactions

        var dataDist = [["price range", "number of items"]]
        for (i=0; i < statistics[0].distributions.length; i++){
            var begin = statistics[0].distributions[i].begin
            var end = statistics[0].distributions[i].end
            var priceCount = statistics[0].distributions[i].count
            dataDist.push([begin.toString() + "-" + end.toString(), priceCount])
        }

        var dataUsers = [["date", "number of active users"]]
        for (i=0; i < statistics[0].activeUsers.length; i++){
            var dateS = statistics[0].activeUsers[i].date
            var userCount = statistics[0].activeUsers[i].count

            dataUsers.push([dateS, userCount])
        }

        google.charts.load('current', {'packages':['bar']});
        google.setOnLoadCallback(function () {
            drawGraph(dataUsers, "graph-active", "Number of active users")
            drawGraph(dataDist, "graph-distr", "Price distribution")
        });
    });
}

function drawGraph(data, name, title_){
        console.log(data)
        var dataitems = new google.visualization.arrayToDataTable(data);

        var options = {
          chartArea: {
              width: '94%'
          },
          legend: { position: 'none' },
          chart: {
            title: title_},
          axes: {
            x: {
              0: { side: 'top'} // Top x-axis.
            }
          },
          bar: { groupWidth: "100%" }
        };

        var chart = new google.charts.Bar(document.getElementById(name));
        // Convert the Classic options to Material options.
        chart.draw(dataitems, google.charts.Bar.convertOptions(options));
}

{#function displayC3() {#}
{#    var c3 = document.getElementById("_container3");#}
{#    if (c3.style.display == "none") {#}
{#        c3.style.display = "block";#}
{#    }#}
{#    else {#}
{#        c3.style.display = "none";#}
{#    }#}
{##}

function toggleDatasetView() {
    var c0 = document.getElementById("_container0");
    var c1 = document.getElementById("_container1");
    var c2 = document.getElementById("_container2");
    var c3 = document.getElementById("_container3");
    if (c0.style.display == "none") {
        c0.style.display = "block";
        c1.style.display = "block";
        c2.style.display = "block";
        c3.style.display = "none";
    }
    else {
        c0.style.display = "none";
        c1.style.display = "none";
        c2.style.display = "none";
        c3.style.display = "block";
    }
    {#event.preventDefault();#}
}

$('button.c0_button').click(function(e) {
    e.preventDefault();
});

{#function selectRow() {#}
{#    row_id = event.target.id;#}

{##}
{#function sendTableData() {#}
{#    var data = document.getElementById(row_id).querySelectorAll(".row_data");#}
{#    var id = data[0].innerHTML;#}
{#    var name = data[1].innerHTML;#}
{#    #}

</script>

<!-- Services Section-->
<!--{#    <div class="dataset" id="dataset">#}-->
<!--{##}-->
<!--{#        <h1>Recommendation algorithms</h1>#}-->
<!--{#        <div class="dataset__wrapper">#}-->
<!--{#            <div class="dataset__card">#}-->
<!--{#                <h2>Popularity</h2>#}-->
<!--{#                <p></p>#}-->
<!--{#                <div class="dataset__btn">#}-->
<!--{#                    <button>Start Setup</button>#}-->
<!--{#                </div>#}-->
<!--{#            </div>#}-->
<!--{#        </div>#}-->
<!--{#    </div>#}-->

</body>
</html>




