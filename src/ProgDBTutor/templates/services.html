<html>
<head>

    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">

	<link rel="stylesheet" href="{{ url_for('static',filename='bootstrap-4.0.0.min.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='style/style.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='style/services_style.css') }}">
	<link rel="stylesheet" href="{{ url_for('static',filename='style/home_style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='style/datasets_style.css') }}">

	<script src="{{ url_for('static',filename='jquery-3.2.1.js') }}"></script>
	<script src="{{ url_for('static',filename='bootstrap-4.0.0.min.js') }}"></script>

{#    <link#}
{#      rel="stylesheet"#}
{#      href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css"#}
{#      integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh"#}
{#      crossorigin="anonymous"#}
{#    />#}
{#    <link#}
{#      rel="stylesheet"#}
{#      href="https://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css"#}
{#      crossorigin="anonymous"#}
{#    />#}

</head>
<body>

<nav class="navbar" id="navbar">
        <div class="navbar_container">
            <div class="navbar_toggle" id="mobile-menu">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
            <ul class="navbar_menu">
                <li class="navbar_items"><a class="navbar_links" id="home-page" href="home">Home</a></li>
                <li class="navbar_items"><a class="navbar_links" id="services-page" href="services">A/B-test</a></li>
                <li class="navbar_items"><a class="navbar_links" id="datasets-page" href="datasets">Datasets</a></li>
                <li class="navbar_items"><a class="navbar_links" id="visualizations-page" href="visualizations">Visualizations</a></li>
                <li class="navbar_items"><a class="navbar_links" id="testlist-page" href="testlist">Testlist</a></li>
            </ul>
        </div>
    </nav>

{#{% with messages = get_flashed_messages(with_categories=true) %}#}
{#    {% if messages %}#}
{#        {% for category, message in messages %}#}
{#            {% if category == 'error' %}#}
{#            <div class="alert alert-danger alter-dismissable fade show" role="alert">#}
{#                {{ message }}#}
{#                <button type="button" class="close" data-dismiss="alert">#}
{#                    <span aria-hidden="true">&times;</span>#}
{#                </button>#}
{#            </div>#}
{#            {% else %}#}
{#            <div class="alert alert-success alter-dismissable fade show" role="alert">#}
{#                {{ message }}#}
{#                <button type="button" class="close" data-dismiss="alert">#}
{#                    <span aria-hidden="true">&times;</span>#}
{#                </button>#}
{#            </div>#}
{#            {% endif %}#}
{#        {% endfor %}#}
{#    {% endif %}#}
{#{% endwith %}#}

<form id="dataForm" method="POST" action="" data-name="cForm">

<div class="abtestpage" id="services">
    <h1>Setting up the A/B-test</h1>
    <div class="abtestcontainer">
        <div class="_row">
            <div class="_column">
                <h2>Add Algorithm</h2>

                <div class="abtestcontainer1">
                        <div class="container___">

{#                            <form id="dataForm" method="POST" action="" data-name="cForm">#}


                              <!-- Dataset Selection-->

                              <select class="ds_select" id="datasetSelection" name="datasetSelection">
                                  {% for id, name in names %}
                                    <option value="{{ id }}">dataset: {{ name }}</option>
                                  {% endfor %}
                              </select>

                              <!-- General parameters Selection-->

                              <div class="row">
                                  <div class="col-25"><label for="startingpoint">Starting point</label></div>

                                  {% if 'gen_par_start' in genParDict.keys() %}
                                    <div class="col-75"><input type="date" id="startingpoint" name="startingpoint" placeholder="Starting point" value="{{ genParDict['gen_par_start'] }}" required></div>
                                  {% else %}
                                    <div class="col-75"><input type="date" id="startingpoint" name="startingpoint" placeholder="Starting point" value="2020-01-01" required></div>
                                  {% endif %}
                              </div>
                              <div class="row">
                                  <div class="col-25"><label for="endpoint">End point</label></div>
                                  {% if 'gen_par_end' in genParDict.keys() %}
                                    <div class="col-75"><input type="date" id="endpoint" name="endpoint" placeholder="End point" value="{{ genParDict['gen_par_end'] }}" required></div>
                                  {% else %}
                                    <div class="col-75"><input type="date" id="endpoint" name="endpoint" placeholder="End point" value="2020-01-09" required></div>
                                  {% endif %}
                              </div>
                              <div class="row">
                                  <div class="col-25"><label for="stepsize">Stepsize</label></div>
                                  {% if 'gen_par_stepsize' in genParDict.keys() %}
                                    <div class="col-75"><input type="text" id="stepsize" name="stepsize" placeholder="Stepsize" value="{{ genParDict['gen_par_stepsize'] }}" required></div>
                                  {% else %}
                                    <div class="col-75"><input type="text" id="stepsize" name="stepsize" placeholder="Stepsize" value="1" required></div>
                                  {% endif %}
                              </div>
                              <div class="row">
                                  <div class="col-25"><label for="topk">Top-k</label></div>
                                  {% if 'gen_par_topk' in genParDict.keys() %}
                                    <div class="col-75"><input type="text" id="topk" name="topk" placeholder="Top-k" value="{{ genParDict['gen_par_topk'] }}" required></div>
                                  {% else %}
                                    <div class="col-75"><input type="text" id="topk" name="topk" placeholder="Top-k" value="5" required></div>
                                  {% endif %}
                              </div>

{#                            </form>#}

{#                            <form id="dataForm1" method="POST" action="">#}


                              <!-- Algorithm Selection-->

                              <select class="_ds_select" id="algoSelection" name="algoSelection" onchange="switchVisibleParameters();">
                                  <option value="popularity">popularity</option>
                                  <option value="recency">recency</option>
                                  <option value="itemknn">itemknn</option>
                              </select>

                              <!-- Algorithm-specific parameters Selection-->

                                <p style="color: black; margin-top: 12px;">Set Algorithm Parameters:</p>

                                <div class="par_form">
                                    <div class="container1" id="popularity_par" style="border: 2px solid black; display: block;">
                                      <div class="row">
                                        <div class="col-25"><label for="windowsize">Window Size</label></div>
                                        <div class="col-75" style="width: 25%"><input type="text" id="windowsize" name="windowsize" placeholder="windowsize" ></div>
                                      </div>
                                      <div class="row">
                                        <div class="col-25"><label for="retraininterval">Retrain interval</label></div>
                                        <div class="col-75" style="width: 25%"><input type="text" id="retraininterval1" name="retraininterval1" placeholder="retraininterval" ></div>
                                      </div>
                                    </div>

                                    <div class="container2" id="recency_par" style="border: 2px solid black; display: none;">
                                      <div class="row">
                                        <div class="col-25"><label for="retraininterval">Retrain interval</label></div>
                                        <div class="col-75" style="width: 25%"><input type="text" id="retraininterval2" name="retraininterval2" placeholder="retraininterval" ></div>
                                      </div>
                                    </div>

                                    <div class="container3" id="itemknn_par" style="border: 2px solid black; display: none;">
                                      <div class="row">
                                        <div class="col-25"><label for="k">K</label></div>
                                        <div class="col-75" style="width: 25%"><input type="text" id="k" name="k" placeholder="k" ></div>
                                      </div>
                                      <div class="row">
                                        <div class="col-25"><label for="window">Window</label></div>
                                        <div class="col-75" style="width: 25%"><input type="text" id="window" name="window" placeholder="window" ></div>
                                      </div>
                                      <div class="row">
                                        <div class="col-25"><label for="normalize">Normalize</label></div>
                                        <div class="col-75" style="width: 25%"><input type="text" id="normalize" name="normalize" placeholder="normalize" ></div>
                                      </div>
                                      <div class="row">
                                        <div class="col-25"><label for="retraininterval">Retrain interval</label></div>
                                        <div class="col-75" style="width: 25%"><input type="text" id="retraininterval3" name="retraininterval3" placeholder="retraininterval" ></div>
                                      </div>
                                    </div>

                                </div>
{#                            <button style="margin-top: 15px; margin-left: auto; margin-right: auto; display: block;" type="submit" name="submit_button" value="algoSubmit" role="button">#}
{#                                Add Algorithm#}
{#                            </button>#}
                            <button style="margin-top: 15px; margin-left: auto; margin-right: auto; display: block;" name="submit_button" value="algoSubmit" role="button" onclick="sendData();">
                                Add Algorithm
                            </button>
{#                            </form>#}
                        </div>
                    </div>

            </div>

            <div class="_column">
                <h2>List of added algorithms</h2>

                <div class="abtestcontainer1" style="background-color: white;">
                    <div class="greycontainer">
                        <table class="scroll-table" id="scrolltable" style="background-color: darkgray;">
                            <thead>
                                <tr>
                                    <td style="border-top: 0;">Algorithm number</td>
                                    <td style="border-top: 0;">Algorithm name</td>
                                    <td style="color: red; border-top: 0;">Remove</td>
                                </tr>
                            </thead>
                            <tbody style="height: 610px;">
                                {% for key, value in algo_dict.items() %}
                                    <tr>
                                        <td>{{ key }}</td>
                                        <td>{{ value }}</td>
                                        <td style="font-size: 20px;color: red;cursor: pointer;"><div onclick="window.location.href='{{ url_for('datasetupload', rowData=key) }}';">&times;</div></td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
            </div>

        </div>
    </div>
    </div>

    <button form="dataForm" style="margin-top: 15px; margin-left: auto; margin-right: auto; display: block;" type="submit" name="submit_button" value="abtestSubmit" role="button">
        Submit A/B-test
    </button>
</div>
</form>

{#<form method="POST" action="" data-name="cForm">#}
{#<div class="_services" id="services">#}
{##}
{##}
{#        <h1>1. Choosing dataset</h1>#}
{#        <p>Select a dataset with the selection button below. <br>#}
{#            If you would like to add a new dataset (for admins only), go to the Datasets page.</p>#}
{##}
{#        <h1>Setting up the algorithm</h1>#}
{#            <div class="_services__card">#}
{#                <div class="par_form">#}
{#                    <div class="container">#}
{##}
{#                          <!-- Dataset Selection-->#}
{##}
{#                          <select class="ds_select" id="datasetSelection" name="datasetSelection">#}
{#                              <option value="dataset 0">dataset 0</option>#}
{#                              <option value="dataset 1">dataset 1</option>#}
{#                              <option value="dataset 2">dataset 2</option>#}
{#                              <option value="dataset 3">dataset 3</option>#}
{#                          </select>#}
{##}
{#                          <!-- General parameters Selection-->#}
{##}
{#                          <div class="row">#}
{#                            <div class="col-25"><label for="startingpoint">Starting point</label></div>#}
{#                            <div class="col-75"><input type="datetime-local" id="startingpoint" name="startingpoint" placeholder="Starting point" required></div>#}
{#                          </div>#}
{#                          <div class="row">#}
{#                            <div class="col-25"><label for="endpoint">End point</label></div>#}
{#                            <div class="col-75"><input type="datetime-local" id="endpoint" name="endpoint" placeholder="End point" required></div>#}
{#                          </div>#}
{#                          <div class="row">#}
{#                            <div class="col-25"><label for="stepsize">Stepsize</label></div>#}
{#                            <div class="col-75"><input type="text" id="stepsize" name="stepsize" placeholder="Stepsize" required></div>#}
{#                          </div>#}
{#                          <div class="row">#}
{#                            <div class="col-25"><label for="topk">Top-k</label></div>#}
{#                            <div class="col-75"><input type="text" id="topk" name="topk" placeholder="Top-k" required></div>#}
{#                          </div>#}
{#                        <form method="POST" data-name="cForm">#}
{#                          <!-- Algorithm Selection-->#}
{##}
{#                            <select class="_ds_select" id="algoSelection" name="algoSelection" onchange="switchVisibleParameters();">#}
{#                                <option value="popularity">popularity</option>#}
{#                                <option value="recency">recency</option>#}
{#                                <option value="itemknn">itemknn</option>#}
{#                            </select>#}
{##}
{#                          <!-- Algorithm-specific parameters Selection-->#}
{##}
{#                            <p style="color: black;">Set Parameters</p>#}
{##}
{#                            <div class="par_form">#}
{#                                <div class="container1" id="popularity_par" style="border: 2px solid black;">#}
{#                                  <div class="row">#}
{#                                    <div class="col-25"><label for="windowsize">Window Size</label></div>#}
{#                                    <div class="col-75" style="width: 25%"><input type="text" id="windowsize" name="windowsize" placeholder="windowsize" ></div>#}
{#                                  </div>#}
{#                                  <div class="row">#}
{#                                    <div class="col-25"><label for="retraininterval">Retrain interval</label></div>#}
{#                                    <div class="col-75" style="width: 25%"><input type="text" id="retraininterval1" name="retraininterval1" placeholder="retraininterval" ></div>#}
{#                                  </div>#}
{#                                </div>#}
{##}
{#                                <div class="container2" id="recency_par" style="border: 2px solid black; opacity: 0;height: 0;width: 0;">#}
{#                                  <div class="row">#}
{#                                    <div class="col-25"><label for="retraininterval">Retrain interval</label></div>#}
{#                                    <div class="col-75" style="width: 25%"><input type="text" id="retraininterval2" name="retraininterval2" placeholder="retraininterval" ></div>#}
{#                                  </div>#}
{#                                </div>#}
{##}
{#                                <div class="container3" id="itemknn_par" style="border: 2px solid black; opacity: 0;height: 0;width: 0;">#}
{#                                  <div class="row">#}
{#                                    <div class="col-25"><label for="k">K</label></div>#}
{#                                    <div class="col-75" style="width: 25%"><input type="text" id="k" name="k" placeholder="k" ></div>#}
{#                                  </div>#}
{#                                  <div class="row">#}
{#                                    <div class="col-25"><label for="window">Window</label></div>#}
{#                                    <div class="col-75" style="width: 25%"><input type="text" id="window" name="window" placeholder="window" ></div>#}
{#                                  </div>#}
{#                                  <div class="row">#}
{#                                    <div class="col-25"><label for="normalize">Normalize</label></div>#}
{#                                    <div class="col-75" style="width: 25%"><input type="text" id="normalize" name="normalize" placeholder="normalize" ></div>#}
{#                                  </div>#}
{#                                  <div class="row">#}
{#                                    <div class="col-25"><label for="retraininterval">Retrain interval</label></div>#}
{#                                    <div class="col-75" style="width: 25%"><input type="text" id="retraininterval3" name="retraininterval3" placeholder="retraininterval" ></div>#}
{#                                  </div>#}
{#                                </div>#}
{##}
{#                            </div>#}
{#                            <div align="center" class="___services__btn" style="margin-top: 20px;">#}
{#                                <button type="submit" >#}
{#                                    Add algorithm#}
{#                                </button>#}
{#                            </div>#}
{#                                <input type="submit" name="submit_button" value="algoSubmit">#}
{#                      </form>#}
{#                    </div>#}
{#                </div>#}
{#            </div>#}
{#    </div>#}
{##}
{#<!-- Services Section-->#}
{#<div class="__services" id="services">#}
{##}
{#        Popularity: window size en retrain interval#}
{#        Recency: retrain interval#}
{#        ItemKNN: K, window, normalize en retrain interval#}
{#    <div class="box">#}
{#        <div class="__container">#}
{##}
{#            <div class="_dataset_title" >List of added algorithms</div>#}
{#            <div class="_dataset__btn">#}
{#                <button name="submit_button" value="remove">Remove algorithm</button>#}
{#            </div>#}
{##}
{#            <div class="_dataset__header">#}
{#                <div class="_dataset__item" tabindex="1">#}
{#                    <ul><li>Algorithm number</li><li>Algorithm name</li></ul>#}
{#                </div>#}
{#            </div>#}
{##}
{#            <div class="_dataset__card">#}
{#                <div class="_dataset__scroll">#}
{#                    {% set count = [] %}#}
{#                    {% for key, value in algo_dict.items() %}#}
{#                        <div class="_dataset__item" tabindex={{ count|length }}>#}
{#                            <ul><li>{{ key }}</li><li>{{ value }}</li></ul>#}
{#                        </div>#}
{#                        {% set __ = count.append(1) %}#}
{#                    {% endfor %}#}
{##}
{#                </div>#}
{#            </div>#}
{#        </div>#}
{#    </div>#}
{#        <div class="___services__btn">#}
{#            <button type="submit">#}
{#                <a href="visualizations">Start Setup</a>#}
{#            </button>#}
{#        </div>#}
{#</div>#}

{#<input type="submit" name="submit_button" value="abtestSubmit">#}

{#</form>#}

<script src="../static/jquery-3.2.1.js">
</script>
<script>
    {#$('#algoSelection').val();#}
    {#var select1 = document.getElementById('algoSelect');#}
    {#var value = select1.options[select1.selectedIndex].value;#}
    {#console.log(value);#}

    {#function update() {#}
    {#    var select = document.getElementById('algoSelection');#}
    {#    var option = select.options[select.selectedIndex];#}
    {##}
    {#    document.getElementById('algoSelection').value = option.value;#}

    {#update();#}


    {#var form = $('form[data-name="cForm"]');#}
    {#form.find($("#startingpoint")).val("2020-01-01");#}
    {#form.find($("#endpoint")).val("2020-09-01");#}
    {#form.find($("#stepsize")).val("1");#}
    {#form.find($("#topk")).val("5");#}


    {#$(document).ready(function() {#}
    {#    $("#algoSelection").change(function() {#}
    {##}
    {#        //Hide -other- visible forms#}
    {#        $("#popularity_par, #recency_par, #itemknn_par").hide();#}
    {#        $("#" + $(this).val()).show();#}
    {#    });#}
    {# });#}

    function switchVisibleParameters() {

    var select = document.getElementById('algoSelection');
    var option = select.options[select.selectedIndex];

    if (option.value == 'popularity') {
            if (document.getElementById('popularity_par').style.display == 'none') {
                document.getElementById('popularity_par').style.display = 'block';
                document.getElementById('recency_par').style.display = 'none';
                document.getElementById('itemknn_par').style.display = 'none';

            }
        }
        else if (option.value == 'recency') {
            if (document.getElementById('recency_par').style.display == 'none') {
                document.getElementById('popularity_par').style.display = 'none';
                document.getElementById('recency_par').style.display = 'block';
                document.getElementById('itemknn_par').style.display = 'none';
            }
        }
        else if (option.value == 'itemknn') {
            if (document.getElementById('itemknn_par').style.display == 'none') {
                document.getElementById('popularity_par').style.display = 'none';
                document.getElementById('recency_par').style.display = 'none';
                document.getElementById('itemknn_par').style.display = 'block';
            }
        }
    }

    $(document).ready(function() {
        setTimeout(function() {
            $('.alert').fadeOut('slow');
            }, 1000); // <-- time in milliseconds
        });

    function sendData() {
    let ds_id = document.getElementById("datasetSelection").value;
    let gen_par_start = document.getElementById("startingpoint").value;
    let gen_par_end = document.getElementById("endpoint").value;
    let gen_par_stepsize = document.getElementById("stepsize").value;
    let gen_par_topk = document.getElementById("topk").value;


    fetch(`/services/addalgorithm`, {
        headers : {
            'Content-Type' : 'application/json'
        },
        method : 'POST',
        body : JSON.stringify( {
            'ds_id' : ds_id,
            'gen_par_start' : gen_par_start,
            'gen_par_end' : gen_par_end,
            'gen_par_stepsize' : gen_par_stepsize,
            'gen_par_topk' : gen_par_topk
        })
    }).then(function(response) {
        return response.text();
    }).then(function(text) {
        console.log(text['ds_id'])
        var dict = JSON.parse(text);

        document.getElementById("datasetSelection").innerHTML = text['ds_id'];
        document.getElementById("startingpoint").innerHTML = text['startingpoint'];
        document.getElementById("endpoint").innerHTML = text['endpoint'];
        document.getElementById("stepsize").innerHTML = text['stepsize'];
        document.getElementById("topk").innerHTML = text['topk'];

    });
}

</script>

</body>
</html>




