<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="{{ url_for('static',filename='style/item_style.css') }}">
    <script src="{{ url_for('static',filename='jquery-3.2.1.js') }}"></script>
</head>
<body>
<form method="POST" action="" name="form1" id="form1">
    <h1 class="main__header">Item Page</h1>
    <div class="container__itemsection">
        <div class="container__info">
            <main class="container__column" id="col1">
                <div class="container__info_item">
                    <table class="item_table flex-fixhead-table">
                        <thead>
                        <tr>
                            <th>Attribute</th>
                            <th>Value</th>
                        </tr>
                        </thead>
                        <tbody>
                        {% for attr, val in attr_val %}
                            <tr>
                                <td data-label="Attribute">{{ attr }}</td>
                                <td data-label="Value">{{ val }}</td>
                            </tr>
                        {% endfor %}
                        </tbody>
                    </table>
                </div>
            </main>
            <main class="container__column" id="col2">
                <div class="container__item_picture">
                    {% if item_picture %}
                        <img src="{{ item_picture }}" width="600px" height="400px" alt="Picture of an item">
                    {% else %}
                        <img src="" width="600px" height="400px" alt="Picture of an item">
                    {% endif %}
                </div>
                <div class="container__selection">
                    <div class="grid-container">
                        <div class="grid-item_1">
                            <select class="select" id="graph_select" name="graph_select">
                                <option value="Popularity item">Popularity item</option>
                                <option value="Recommendation count">Recommendation count</option>
                                <option value="Recommendation correctness">Recommendation correctness</option>
                            </select>
                        </div>
                        <div class="grid-item_1">
                            <button class="_button" role="button" id="submit_graph" name="submit_graph">
                                Show graph
                            </button>
                        </div>
                    </div>
                    <div class="grid-container">
                        <div class="grid-item_1">
                            <input class="_date" type="date" placeholder="Begin" id="begin_time" name="begin_time" value="2020-01-01" required>
                        </div>
                        <div class="grid-item_1">
                            <input class="_date" type="date" placeholder="End" id="end_time" name="end_time" value="2020-01-09" required>
                        </div>
                    </div>
                </div>
            </main>
            <div class="container__graph" id="item_graph"></div>
        </div>
    </div>
</form>

<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
<script type="text/javascript">
    google.charts.load('current', {'packages':['corechart', 'bar']});

   $(function() {
       $('#submit_graph').click(function(e) {
           var form_data = new FormData($('#form1')[0]);
           console.log(form_data);
           $.ajax({
               type: 'POST',
               url: '/itemsection_graph',
               data: form_data,
               contentType: false,
               cache: false,
               processData: false,
               success: function(data) {
                   graph(data);
                },
            });
       });
   });

    $('button._button').click(function (e){
        e.preventDefault();
    })

    function graph(data) {
        google.setOnLoadCallback(drawGraph(data));
    }

    function drawGraph(data) {
        var chart;
        var options;
        var dataitems;
        var d = data;

        if (d['graph_type'] == "Popularity item") {
            dataitems = new google.visualization.arrayToDataTable(d['data']);
            chart = new google.charts.Bar(document.getElementById(d['name']));
            options = {
                chartArea: {
                    width: '94%'
                },
                legend: {position: 'none'},
                chart: {
                    title: 'Popularity item',
                },
                axes: {
                    x: {
                        0: {side: 'top'} // Top x-axis.
                    }
                },
                bar: {groupWidth: "100%"}
            };
            // Convert the Classic options to Material options.
            chart.draw(dataitems, google.charts.Bar.convertOptions(options));
        }
        else if (d['graph_type'] == "Recommendation count") {
            dataitems = new google.visualization.arrayToDataTable(d['data']);
            chart = new google.visualization.LineChart(document.getElementById(d['name']));
            options = {
                chartArea: {
                    width: '94%'
                },
                legend: {position: 'bottom'},
                chart: {
                    title: 'Recommendation count',
                },
                axes: {
                    x: {
                        0: {side: 'top'} // Top x-axis.
                    }
                },
                bar: {groupWidth: "100%"},
            };
            // Convert the Classic options to Material options.
            chart.draw(dataitems, options);
        }
        else if (d['graph_type'] == "Recommendation correctness") {
            dataitems = new google.visualization.DataTable();
            dataitems.addColumn('string', 'Date');
            for (var x of d['columns']) {
                dataitems.addColumn('number', x);
            }
{#            {% for item in d['columns'] %}#}
{#                dataitems.addColumn('number', '{{ item }}');#}
{#            {% endfor %}#}
            dataitems.addRows(d['data'])
            chart = new google.charts.Bar(document.getElementById(d['name']));
            options = {
                isStacked: true,
                chartArea: {
                    width: '94%'
                },
                legend: {position: 'bottom'},
                curveType: 'function',
                chart: {
                    title: 'Recommendation correctness',
                },
                axes: {
                    x: {
                        0: {side: 'top'} // Top x-axis.
                    }
                },
                vAxis: {
                    viewWindow: {
                    }
                },
                series: {

                },
                bar: {groupWidth: "90%"},
            };

            // Adjust series
            for (var y of d['numbers']) {
                options.series[y[0]] = {targetAxisIndex: y[1]};
            }
{#            {% for item in d['numbers'] %}#}
{#                options.series[{{ item[0] }}] = {targetAxisIndex: {{ item[1] }}};#}
{#            {% endfor %}#}

            options.vAxis.viewWindow.min = 0;
            options.vAxis.viewWindow.max = d['maxYValue'];

            // Convert the Classic options to Material options.
            chart.draw(dataitems, google.charts.Bar.convertOptions(options));
        }
    }
</script>
</body>
</html>
