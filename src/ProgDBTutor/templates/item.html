<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='images/favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='style/navbar.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='style/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static',filename='style/item_style.css') }}">
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>
    <script src="{{ url_for('static',filename='jquery-3.2.1.js') }}"></script>
</head>
<body>

{#Navbar section#}

<nav class="navbar" id="navbar">
    <div class="navbar_container">
        <div class="navbar_toggle" id="mobile-menu">
            <span class="bar"></span>
            <span class="bar"></span>
            <span class="bar"></span>
        </div>
        <ul class="navbar_menu">
            <li class="navbar_items"><a class="navbar_links" id="home-page" href="home">Home</a></li>
            <li class="navbar_items"><a class="navbar_links" id="datasets-page" href="datasets">Datasets</a></li>
            <li class="navbar_items"><a class="navbar_links" id="services-page" href="services">A/B-test</a></li>
            <li class="navbar_items"><a class="navbar_links" id="testlist-page" href="testlist">Testlist</a></li>
        </ul>
    </div>
</nav>
<div class="container__body" id="body_page">
    <form method="POST" action="" name="form1" id="form1">

        {# Item page #}
        <div class="container__page" id="itempage">

            {# Layer 1 #}
            <div class="container__layer" id="layer1">

                {# Column table information item #}
                <div class="container__column" id="layer1_column1">

                    {# content of the table information #}
                    <div class="container__content" id="layer1_column1_content">

                        {# Table item information #}
                        <table class="container__table" id="layer1_column1_table">
                            <thead class="container__tablehead" id="layer1_column1_table_head">
                                <tr class="container__tablerow" id="layer1_column1_table_head_row1">
                                    {# Table headers #}
                                    <th class="container__tableheadcontent" id="table_head_row1_column1">Attribute</th>
                                    <th class="container__tableheadcontent" id="table_head_row1_column2">Value</th>
                                    {# ############# #}
                                </tr>
                            </thead>
                            <tbody class="container__tablebody" id="layer1_column1_table_body">
                                {% for attr, val in attr_val %}
                                    <tr class='container__tablerow'>
                                        <td class='container__tablerowcontent' data-label="Attribute">{{ attr }}</td>
                                        <td class='container__tablerowcontent' data-label="Value">{{ val }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                        {# ###################### #}

                    </div>
                    {# ################################ #}

                </div>
                {# ############################# #}

                {# Column item picture and interval picker #}
                <div class="container__column" id="layer1_section1">

                    {# Column item picture #}
                    <div class="container__column" id="layer1_section1_column1">

                        {# Head of the picture column #}
                        <div class="container__head" id="section1_column1_head">
                            <h2>Picture of the article</h2>
                        </div>
                        {# ########################## #}

                        {# Content of the picture column #}
                        <div class="container__content" id="section1_column1_content">
                            {% if item_picture %}
                                <img src="{{ item_picture }}" style=" width:100%; height:100%; object-fit: contain"alt="Picture of an item">
                            {% else %}
                                <img src="" style=" width:100%; height:100%; object-fit: contain" alt="Picture of an item">
                            {% endif %}
                        </div>
                        {# ############################# #}

                    </div>
                    {# ################### #}

                    {# Column interval picker #}
                    <div class="container__column" id="layer1_section1_column2">

                        {# Content of the interval picker #}
                        <div class="container__content" id="section1_column2_content">

                            {# row 1 #}
                            <div class="container__row" id="section1_row1">
                                {# type graph picker #}
                                <div class="container__innerColumn" id="section1_row1_inner1">
                                    <select class="container__select" id="graph_select" name="graph_select">
                                        <option value="Popularity item">Popularity item</option>
                                        <option value="Recommendation count">Recommendation count</option>
                                        <option value="Recommendation correctness">Recommendation correctness</option>
                                    </select>
                                </div>
                                {# ################# #}
                                <div class="container__innerColumn" id="section1_row1_inner2">
                                    <div class="container__button" id="section1_buttongraph">
                                        <button id="submit_graph" name="submit_graph" role="button" >
                                            Show graph
                                        </button>
                                    </div>
                                </div>
                            </div>
                            {# ##### #}

                            {# row 2 #}
                            <div class="container__row" id="section1_row2">
                                <div class="container__innerColumn" id="section1_row2_inner1">
                                    <input type="date" class="container__input" id="input_startpoint"
                                           name="input_startpoint" value="2020-01-01"
                                           placeholder="Begin" required>
                                </div>
                                <div class="container__innerColumn" id="section1_row2_inner2">
                                    <input type="date" class="container__input" id="input_endpoint"
                                           name="input_endpoint" value="2020-01-09"
                                           placeholder="End" required>
                                </div>
                            </div>
                            {# #### #}

                        </div>
                        {# ############################## #}

                    </div>
                    {# ###################### #}

                </div>
                {# ####################################### #}

            </div>
            {# ####### #}

            {# Layer 2 #}
            <div class="container__layer" id="layer2">

                {# Column graphs #}
                <div class="container__column" id="layer2_column1">

                    {# Head of the graphs #}
                    <div class="container__head" id="layer2_column1_head">
                        <h2>Choose a graph</h2>
                    </div>
                    {# ################## #}

                    {# Content of the graphs #}
                    <div class="container__content" id="layer2_column1_content">

                    </div>
                    {# ##################### #}
                    <div class="container__button" id="layer2_buttongraph">
                        <button id="graph_rotater" name="graph_rotater" role="button" >
                            Rotate
                        </button>
                    </div>

                </div>
                {# ############# #}

            </div>
            {# ####### #}

        </div>
        {# ######### #}
    </form>
</div>
<script type="text/javascript">
    google.charts.load('current', {'packages':['corechart', 'bar']});

    let rotation = false;
   $(function() {
       $('#submit_graph').click(function() {
           var form_data = new FormData($('#form1')[0]);
           form_data.append('dataset_id', '{{ dataset_id }}')
           form_data.append('abtest_id', '{{ abtest_id }}')
           form_data.append('item_id', '{{ item_id }}')
           console.log(form_data);
           $.ajax({
               type: 'POST',
               url: '/itemsection_graph',
               data: form_data,
               contentType: false,
               cache: false,
               processData: false,
               success: function(data) {
                   graph(data);
                },
            });
       });
   });

  $(function() {
       $('#graph_rotater').click(function() {
           rotation = !rotation;

           let layer = document.getElementById("layer2")
           let graph = document.getElementById("layer2_column1");
           let head = document.getElementById("layer2_column1_head");
           let content = document.getElementById("layer2_column1_content");
           let body = document.getElementById("body_page");
           let page = document.getElementById("itempage");

            if (rotation) {
                layer.style.transform = "rotate(90deg)";
                layer.style.height = "1000px"
                graph.style.width = "1000px";
                head.style.width = "1000px";
                content.style.width = "1000px";
                body.style.height = "2470px";
                page.style.height = "2370px";
            }

            else {
                layer.style.transform = "rotate(0deg)";

                layer.style.justifyContent = "center"
                layer.style.alignContent = "center"
                layer.style.marginLeft = "50px"
                layer.style.marginTop = "20px"

                graph.style.width = "613px";
                head.style.width = "613px";
                content.style.width = "613px";
                layer.style.height = "613px";
                page.style.height = "1983px";
                body.style.height = "2083x";
            }
        });

   });

    $('button#submit_graph').click(function (e){
        e.preventDefault();
    })

    $('button#graph_rotater').click(function (e){
        e.preventDefault();
    })

    function graph(data) {
        google.setOnLoadCallback(drawGraph(data));
    }

    function drawGraph(data) {
        var chart;
        var options;
        var dataitems;
        var d = data;

        if (d['graph_type'] == "Popularity item") {

            document.getElementById("layer2_column1_head").innerHTML = "<h2> Popularity item </h2>"
            dataitems = new google.visualization.arrayToDataTable(d['data']);
            chart = new google.charts.Bar(document.getElementById("layer2_column1_content"));
            options = {
                chartArea: {
                    width: '94%'
                },
                legend: {position: 'none'},
                vAxis: {
                    title: 'Amount of purchases'
                },
                bar: {groupWidth: "100%"}
            };
            // Convert the Classic options to Material options.
            chart.draw(dataitems, google.charts.Bar.convertOptions(options));
        }
        else if (d['graph_type'] == "Recommendation count") {
            document.getElementById("layer2_column1_head").innerHTML = "<h2> Recommendation count </h2>"
            dataitems = new google.visualization.arrayToDataTable(d['data']);
            chart = new google.visualization.LineChart(document.getElementById("layer2_column1_content"));
            options = {
                chartArea: {
                    width: '94%'
                },
                legend: {position: 'bottom'},
                vAxis: {
                    title: 'Amount of recommendations'
                },
                bar: {groupWidth: "100%"},
            };
            // Convert the Classic options to Material options.
            chart.draw(dataitems, options);
        }
        else if (d['graph_type'] == "Recommendation correctness") {
            document.getElementById("layer2_column1_head").innerHTML = "<h2> Recommendation correctness </h2>"
            dataitems = new google.visualization.DataTable();
            dataitems.addColumn('string', 'Date');
            for (var x of d['columns']) {
                dataitems.addColumn('number', x);
            }
            dataitems.addRows(d['data'])
            chart = new google.charts.Bar(document.getElementById("layer2_column1_content"));
            options = {
                isStacked: true,
                chartArea: {
                    width: '94%'
                },
                legend: {position: 'bottom'},
                curveType: 'function',
                vAxis: {
                    viewWindow: {
                    }
                },
                series: {

                },
                bar: {groupWidth: "90%"},
            };

            // Adjust series
            for (var y of d['numbers']) {
                options.series[y[0]] = {targetAxisIndex: y[1]};
            }

            options.vAxis.viewWindow.min = 0;
            options.vAxis.viewWindow.max = d['maxYValue'];

            // Convert the Classic options to Material options.
            chart.draw(dataitems, google.charts.Bar.convertOptions(options));
        }
    }

    const menu = document.getElementById("mobile-menu");
    const menuLinks = document.querySelector(".navbar_menu")
    // Display Mobile Menu
    const mobileMenu = () => {
        menu.classList.toggle('is-active');
        menuLinks.classList.toggle('active');
    }

    menu.addEventListener('click', mobileMenu);


</script>
</body>
</html>